package bin

import "sort"

// InstructionDefinition describes an opcode
type InstructionDefinition struct {
	Opcode    uint32 // Opcode value
	Label     string // Mnemonic name
	ArgCount  int    // Number of arguments
}

// opcodeTable is sorted by opcode for binary search
var opcodeTable = []InstructionDefinition{
	{0x01, "u004149C0", 0},
	{0x02, "exit", 0},
	{0x03, "call-script", 1},
	{0x04, "u00417E30", 2},
	{0x05, "ret", 0},
	{0x06, "u00417E80", 2},
	{0x07, "u00417F90", 1},
	{0x08, "u00417FC0", 1},
	{0x09, "exit-script", 0},
	{0x0A, "u00424170", 2},
	{0x0B, "u00418090", 11},
	{0x0C, "u004149E0", 0},
	{0x0D, "u004181A0", 4},
	{0x0E, "u00418200", 12},
	{0x0F, "u00418300", 1},
	{0x10, "u00414A00", 4},
	{0x11, "u00418330", 9},
	{0x12, "u004183F0", 1},
	{0x13, "u00418420", 4},
	{0x14, "u00414A20", 0},
	{0x15, "u00418490", 5},
	{0x16, "u00418520", 2},
	{0x17, "u00418560", 2},
	{0x1E, "u004185B0", 8},
	{0x1F, "u00418690", 12},
	{0x20, "u004187C0", 6},
	{0x21, "u00418860", 2},
	{0x22, "u00418920", 2},
	{0x23, "u004189D0", 2},
	{0x24, "u00418A90", 2},
	{0x25, "u00418B40", 3},
	{0x26, "u00418C00", 4},
	{0x27, "u00418CC0", 4},
	{0x28, "u00418D90", 4},
	{0x2A, "u00418E60", 4},
	{0x2B, "u00418F30", 5},
	{0x2C, "u00419010", 5},
	{0x2D, "u004190A0", 12},
	{0x2E, "u004194B0", 5},
	{0x2F, "u004195A0", 4},
	{0x30, "u00419670", 5},
	{0x31, "u00419750", 4},
	{0x32, "u004197C0", 10},
	{0x33, "u00419900", 6},
	{0x34, "u004199C0", 12},
	{0x35, "u00419AF0", 11},
	{0x36, "u00419C00", 3},
	{0x37, "u00419C90", 11},
	{0x38, "u00419DA0", 12},
	{0x50, "add", 3},
	{0x51, "sub", 3},
	{0x52, "mul", 3},
	{0x53, "div", 3},
	{0x54, "mod", 3},
	{0x55, "mov", 2},
	{0x56, "and", 3},
	{0x57, "or", 3},
	{0x58, "sar", 3},
	{0x59, "shl", 3},
	{0x5A, "eq", 3},
	{0x5B, "ne", 3},
	{0x5C, "lt", 3},
	{0x5D, "lte", 3},
	{0x5E, "gr", 3},
	{0x5F, "gre", 3},
	{0x60, "u0041A270", 2},
	{0x61, "lookup-array", 3},
	{0x62, "u0041A360", 3},
	{0x63, "u00414A60", 2},
	{0x64, "copy-local-array", 2},
	{0x65, "u00414AA0", 2},
	{0x66, "u00414AE0", 3},
	{0x67, "u00414B20", 3},
	{0x68, "u00414B60", 3},
	{0x69, "u00414BA0", 3},
	{0x6A, "u00414BE0", 3},
	{0x6B, "u00414C20", 3},
	{0x6C, "copy-to-global", 2},
	{0x6D, "u00416960", 0},
	{0x6E, "show-text", 2},
	{0x6F, "end-text-line", 1},
	{0x70, "u0041A750", 5},
	{0x71, "u0041A7B0", 1},
	{0x72, "wait-for-input", 1},
	{0x73, "u0041AB30", 10},
	{0x74, "u0041AC00", 1},
	{0x75, "u0041AC30", 1},
	{0x76, "u0041AC60", 1},
	{0x77, "u0041ACB0", 1},
	{0x78, "u0041AD00", 1},
	{0x79, "u0041AD30", 3},
	{0x7A, "u0041AD70", 3},
	{0x7B, "u0041ADB0", 2},
	{0x7C, "u00416A90", 0},
	{0x7D, "u0041AE00", 2},
	{0x7E, "u0041AEA0", 1},
	{0x7F, "u00414C60", 1},
	{0x80, "u0041AF00", 1},
	{0x81, "u0041AF30", 1},
	{0x82, "u0041AF80", 5},
	{0x83, "u00414C90", 3},
	{0x84, "u0041AFE0", 1},
	{0x85, "u00414CF0", 0},
	{0x86, "u0041B210", 1},
	{0x87, "u00414D10", 0},
	{0x88, "u0041B290", 1},
	{0x89, "u0041B2E0", 4},
	{0x8A, "u0041B330", 6},
	{0x8B, "u0041B3D0", 1},
	{0x8C, "jmp", 1},
	{0x8D, "u0041BCE0", 2},
	{0x8E, "u0041BD60", 1},
	{0x8F, "call", 1},
	{0x90, "u0041BEB0", 7},
	{0x91, "u0041BFB0", 1},
	{0x92, "u0041C030", 2},
	{0x93, "u00415040", 0},
	{0x94, "u00415090", 0},
	{0x95, "u0041C0C0", 2},
	{0x96, "u004150C0", 0},
	{0x97, "u0041C150", 5},
	{0xA0, "jcc", 3},
	{0xA1, "u00427C00", 0},
	{0xA2, "u00427FD0", 2},
	{0xA3, "u004244D0", 2},
	{0xAA, "u0041C270", 2},
	{0xAB, "u0041C330", 2},
	{0xAC, "u0041C3E0", 9},
	{0xAD, "u00415110", 0},
	{0xAE, "u00415130", 0},
	{0xAF, "u00415480", 0},
	{0xB0, "u0041C530", 1},
	{0xB1, "u0041C560", 1},
	{0xB2, "u0041C590", 2},
	{0xB3, "u004154B0", 0},
	{0xB4, "play-sound-effect", 2},
	{0xB5, "u0041D050", 1},
	{0xB6, "u0041D080", 1},
	{0xB7, "u0041D0E0", 1},
	{0xB8, "u00415520", 0},
	{0xB9, "u0041D140", 1},
	{0xBA, "u0041D0B0", 1},
	{0xBB, "u0041D250", 1},
	{0xBC, "u0041D280", 1},
	{0xBD, "u00415570", 1},
	{0xBE, "u004155E0", 1},
	{0xBF, "play-bgm", 1},
	{0xC0, "u00415620", 1},
	{0xC1, "u00415650", 0},
	{0xC2, "u0041D2B0", 2},
	{0xC3, "u0041D390", 1},
	{0xC4, "play-voice", 1},
	{0xC5, "u0041D4A0", 2},
	{0xC6, "u0041D5D0", 2},
	{0xC7, "u0041D760", 2},
	{0xC8, "sleep", 1},
	{0xC9, "u00415770", 0},
	{0xCA, "u004157A0", 0},
	{0xCB, "u00415800", 1},
	{0xCC, "mouse_callback", 2},
	{0xCD, "get-input-type", 0},
	{0xCE, "u0041E0B0", 3},
	{0xCF, "u00416D40", 0},
	{0xD0, "u00415830", 1},
	{0xD1, "u00415860", 0},
	{0xD2, "u0041E110", 1},
	{0xD3, "u00425960", 0},
	{0xD4, "u004266F0", 4},
	{0xD5, "u004262C0", 1},
	{0xD6, "u004267D0", 6},
	{0xD7, "u0041E1A0", 1},
	{0xD8, "u0041E150", 2},
	{0xD9, "u00415880", 0},
	{0xDA, "u004158B0", 6},
	{0xFA, "u00415940", 0},
	{0xFB, "joy_callback", 2},
	{0xFC, "u004159F0", 0},
	{0xFD, "u0041E2D0", 2},
	{0xFE, "u0041E360", 1},
	{0xFF, "u00415A10", 0},
	{0x100, "u00415A60", 0},
	{0x101, "u00415BF0", 0},
	{0x102, "u0041E3C0", 3},
	{0x103, "u0041E4A0", 1},
	{0x104, "u00415C50", 0},
	{0x105, "u0041E4D0", 1},
	{0x106, "u00415E40", 1},
	{0x107, "u0041E500", 2},
	{0x108, "u00415E70", 1},
	{0x109, "u00415EC0", 2},
	{0x10A, "u0041E540", 2},
	{0x10B, "u0041E5A0", 2},
	{0x10C, "u0041E5E0", 2},
	{0x10D, "u00415F10", 1},
	{0x10E, "u0041E650", 2},
	{0x10F, "u0041E690", 1},
	{0x12C, "lookup-array-2d", 5},
	{0x12D, "u0041E720", 7},
	{0x12E, "u0041E940", 8},
	{0x12F, "u0041ECB0", 4},
	{0x130, "u00415F40", 1},
	{0x131, "u00415F70", 1},
	{0x132, "u0041EF00", 1},
	{0x133, "u0041EFF0", 2},
	{0x134, "u0041F050", 3},
	{0x135, "bit-set", 2},
	{0x136, "bit-reset", 2},
	{0x137, "u0041F1C0", 1},
	{0x138, "u0041F2B0", 2},
	{0x139, "u0041F310", 3},
	{0x13A, "u0041F3A0", 6},
	{0x13B, "u0041F440", 7},
	{0x13C, "u0041F7E0", 1},
	{0x13D, "u0041F840", 3},
	{0x13E, "u0041F8D0", 2},
	{0x13F, "check-bit", 3},
	{0x140, "u0041F9C0", 4},
	{0x141, "u0041FAA0", 1},
	{0x142, "u0041FB10", 1},
	{0x143, "u00415FB0", 0},
	{0x144, "u004259D0", 2},
	{0x145, "u00416040", 1},
	{0x146, "u0041FB40", 1},
	{0x147, "u0041FB80", 6},
	{0x148, "u004160A0", 1},
	{0x149, "u0041FCE0", 1},
	{0x14A, "u0041FD10", 7},
	{0x14B, "u0041FF50", 1},
	{0x14C, "set-agerc-export", 2},
	{0x14D, "call-agerc-export", 6},
	{0x190, "u0041C5E0", 2},
	{0x191, "u0041A4A0", 2},
	{0x192, "set-string", 2},
	{0x193, "concat", 3},
	{0x194, "u00425480", 3},
	{0x195, "u00425580", 3},
	{0x196, "display-furigana", 3},
	{0x197, "u0041B510", 1},
	{0x198, "u0041B540", 3},
	{0x199, "u00414D50", 0},
	{0x19A, "u00414E50", 1},
	{0x19B, "u00414E80", 0},
	{0x19C, "u00414EC0", 0},
	{0x19D, "u0041C680", 2},
	{0x19E, "u0041C6E0", 2},
	{0x19F, "u0041C860", 2},
	{0x1A0, "u0041C9B0", 9},
	{0x1A1, "u0041CB40", 2},
	{0x1A2, "u00428010", 1},
	{0x1A3, "string-lookup-set", 1},
	{0x1A4, "u0041B580", 2},
	{0x1A5, "set-font", 1},
	{0x1A6, "halve-strlen", 2},
	{0x1A7, "comment", 1},
	{0x1A8, "dev_ukn", 0},
	{0x1A9, "u00428090", 1},
	{0x1AA, "u00425920", 1},
	{0x1AB, "u0041CCA0", 2},
	{0x1AC, "u0041CD80", 3},
	{0x1AD, "u004154F0", 0},
	{0x1AE, "u0041CED0", 3},
	{0x1AF, "u004245C0", 3},
	{0x1B0, "u0041A510", 3},
	{0x1B1, "u0041B5C0", 1},
	{0x1B2, "u00425790", 1},
	{0x1B3, "u004257D0", 0},
	{0x1B4, "u004237C0", 0},
	{0x1B5, "u0041B5F0", 1},
	{0x1B6, "u00414F60", 1},
	{0x1B7, "u0041B640", 1},
	{0x1B8, "u0041B670", 2},
	{0x1B9, "u0041B710", 2},
	{0x1BA, "u0041D850", 2},
	{0x1BB, "u0041B7B0", 1},
	{0x1BC, "u00415670", 0},
	{0x1BD, "u0041D910", 1},
	{0x1BE, "u0041D9D0", 2},
	{0x1BF, "u004156C0", 0},
	{0x1C0, "u0041DB70", 1},
	{0x1C1, "u0041B820", 3},
	{0x1C2, "u0041B860", 2},
	{0x1C3, "u0041B8A0", 2},
	{0x1C4, "u00415720", 1},
	{0x1C5, "u00425800", 4},
	{0x1C6, "u0041DD80", 2},
	{0x1C7, "u00414F90", 1},
	{0x1C8, "toString", 2},
	{0x1C9, "u0041B8E0", 3},
	{0x1CA, "u0041B9B0", 1},
	{0x1CB, "u00414FD0", 1},
	{0x1CC, "u00415010", 1},
	{0x1CD, "u0041A560", 2},
	{0x1CE, "u0041B9F0", 1},
	{0x1CF, "u0041DA10", 1},
	{0x1D0, "u0041BA80", 3},
	{0x1D1, "u0041BAE0", 5},
	{0x1D2, "u0041BB40", 2},
	{0x1D3, "u0041BB90", 5},
	{0x1D4, "u0041BC00", 4},
	{0x1D5, "u00415700", 0},
	{0x1D6, "u0041DA40", 2},
	{0x1D7, "u0041DA80", 2},
	{0x1D8, "u0041DAD0", 3},
	{0x1D9, "u0041DB20", 2},
	{0x1F4, "u004160D0", 0},
	{0x1F5, "u00416120", 0},
	{0x1F6, "u00416170", 0},
	{0x1F7, "u00420270", 2},
	{0x1F8, "create-texture", 4},
	{0x1F9, "set-texture", 3},
	{0x1FA, "u00420480", 1},
	{0x1FB, "draw-texture", 8},
	{0x1FC, "u004205F0", 1},
	{0x1FD, "u00420620", 4},
	{0x1FE, "u004206C0", 5},
	{0x1FF, "u00420770", 4},
	{0x200, "u00420800", 1},
	{0x201, "u00416190", 1},
	{0x202, "u00420880", 5},
	{0x203, "u00420950", 4},
	{0x204, "draw-string", 4},
	{0x205, "u00420A60", 6},
	{0x206, "u004161C0", 7},
	{0x207, "u00420B00", 8},
	{0x208, "u00420BF0", 3},
	{0x209, "u00420C50", 5},
	{0x20A, "u00420CE0", 1},
	{0x20B, "u00420D50", 7},
	{0x20C, "u00416200", 0},
	{0x20D, "u00420E10", 1},
	{0x20E, "u00416250", 0},
	{0x20F, "u00420E40", 3},
	{0x210, "u00420FF0", 1},
	{0x211, "u00421060", 1},
	{0x212, "u00421090", 2},
	{0x213, "u004210D0", 3},
	{0x214, "u00421120", 2},
	{0x215, "u00421160", 2},
	{0x216, "u004211A0", 2},
	{0x217, "u004211E0", 4},
	{0x218, "u00421270", 4},
	{0x219, "u004212E0", 4},
	{0x21A, "u00421370", 4},
	{0x21B, "u004213E0", 1},
	{0x21C, "u00416270", 0},
	{0x21D, "u00421410", 2},
	{0x21E, "u00421450", 6},
	{0x21F, "u00421510", 7},
	{0x220, "u004215D0", 6},
	{0x221, "u00421670", 4},
	{0x222, "u004216C0", 2},
	{0x223, "u00421700", 8},
	{0x224, "u00416290", 0},
	{0x225, "u00421780", 2},
	{0x226, "u004217D0", 5},
	{0x227, "u00421880", 6},
	{0x228, "u00421940", 5},
	{0x229, "u004219E0", 5},
	{0x22A, "u00421A90", 3},
	{0x22B, "u00421B30", 4},
	{0x22C, "u00421BD0", 3},
	{0x22D, "u00421C60", 5},
	{0x22E, "u00421D10", 6},
	{0x22F, "u00421DD0", 5},
	{0x230, "u00421E70", 1},
	{0x231, "u00421EA0", 4},
	{0x232, "u00421EF0", 4},
	{0x233, "u00421FB0", 5},
	{0x234, "u00422060", 5},
	{0x235, "u00422100", 5},
	{0x236, "u004221A0", 4},
	{0x237, "u00422350", 2},
	{0x238, "u00422390", 1},
	{0x239, "u004223C0", 6},
	{0x23A, "u00422420", 2},
	{0x23B, "u00422460", 7},
	{0x23C, "u004162B0", 0},
	{0x23D, "u004162F0", 0},
	{0x23E, "u004228C0", 2},
	{0x23F, "u00422930", 2},
	{0x240, "u004229A0", 4},
	{0x241, "u00422B80", 5},
	{0x242, "u00422D60", 2},
	{0x243, "u00417070", 0},
	{0x244, "u00416360", 0},
	{0x245, "u00422DA0", 2},
	{0x246, "u00422E10", 2},
	{0x247, "u00416390", 1},
	{0x248, "u00422E80", 1},
	{0x249, "u00422EB0", 3},
	{0x24A, "u004163C0", 3},
	{0x24D, "u00422E90", 12},
	{0x24E, "u00422EA0", 1},
	{0x24F, "u00422ED0", 10},
	{0x250, "u00422F60", 10},
	{0x251, "u00422FF0", 12},
	{0x252, "u00423000", 1},
	{0x253, "u00423019", 2},
	{0x254, "u00423049", 5},
	{0x256, "u00423050", 5},
	{0x257, "op257", 5},
	{0x258, "u00422FE0", 2},
	{0x259, "u00416410", 0},
	{0x25A, "u00423120", 1},
	{0x25B, "op25B", 1},
	{0x25C, "u00423122", 8},
	{0x25D, "u00423123", 3},
	{0x25E, "u00423124", 5},
	{0x25F, "u00423125", 4},
	{0x260, "u00423126", 4},
	{0x261, "u00423127", 1},
	{0x262, "op262", 1},
	{0x263, "op263", 1},
	{0x264, "op264", 5},
	{0x2BC, "u00423020", 11},
	{0x2BD, "u00423100", 1},
	{0x2BE, "u00423140", 1},
	{0x2BF, "u00423180", 3},
	{0x2C0, "u004231C0", 3},
	{0x2C1, "u00425BC0", 1},
	{0x2C2, "u00425CD0", 6},
	{0x2C3, "u00423200", 2},
	{0x2C4, "u00416450", 0},
	{0x2C5, "strlen", 2},
	{0x2C6, "u0042B5E0", 2},
	{0x2C7, "u0042B5F0", 4},
	{0x2C8, "u0042B610", 4},
	{0x2C9, "op2C9", 3},
	{0x2CC, "op2CC", 1},
	{0x2CD, "op2CD", 1},
	{0x2CE, "u0042B616", 1},
	{0x2CF, "u0042B617", 1},
	{0x2D0, "u0042B940", 3},
	{0x2D1, "u0042B950", 3},
	{0x2D2, "u0042B960", 3},
	{0x2D3, "u0042B970", 3},
	{0x2D5, "u0042B990", 2},
	{0x2D7, "u0042B9B0", 2},
	{0x2D8, "set-array-to", 3},
	{0x2D9, "u0042BA30", 2},
	{0x2DA, "u004234E0", 8},
	{0x2DB, "u004235C0", 1},
	{0x2DC, "u0042BA80", 1},
	{0x2DD, "u0042D880", 2},
	{0x2DE, "u0042BAC0", 2},
	{0x2DF, "u0042BAC1", 3},
	{0x2E0, "u0042CE0F", 3},
	{0x2E1, "u0042CE10", 3},
	{0x2E2, "u0042CE11", 3},
	{0x2E3, "u0042CE30", 3},
	{0x2E4, "u0042CE31", 3},
	{0x2E5, "u0042CE50", 1},
	{0x2E6, "u0042CE60", 2},
	{0x2E7, "u0042CE70", 2},
	{0x2E8, "u0042CE80", 1},
	{0x2E9, "u0042CE90", 1},
	{0x2EA, "u0042CEA0", 1},
	{0x2EB, "u0042CEB0", 1},
	{0x2EC, "u0042CEC0", 2},
	{0x2EE, "u0042CEC2", 1},
	{0x2EF, "u0042CEC3", 11},
	{0x2F0, "u0042CEC4", 9},
	{0x2F1, "u0042CEC5", 7},
	{0x2F2, "u0042CEC6", 6},
	{0x2F3, "op2F3", 6},
	{0x2F4, "op2F4", 3},
	{0x2F5, "op2F5", 4},
	{0x2F6, "op2F6", 1},
	{0x2F7, "op2F7", 1},
	{0x2F8, "op2F8", 2},
	{0x2F9, "op2F9", 7},
	{0x2FA, "op2FA", 1},
	{0x2FB, "op2FB", 1},
	{0x2FC, "op2FC", 5},
	{0x2FD, "op2FD", 6},
	{0x2FE, "op2FE", 1},
	{0x2FF, "op2FF", 2},
	{0x300, "op300", 3},
	{0x301, "op301", 1},
	{0x302, "op302", 2},
	{0x303, "op303", 3},
	{0x304, "op304", 0},
	{0x305, "op305", 0},
	{0x306, "op306", 1},
	{0x307, "op307", 1},
	{0x308, "op308", 1},
	{0x30A, "op30A", 2},
	{0x30C, "op30C", 1},
	{0x320, "u0043AA20", 10},
	{0x321, "u0043AA30", 3},
	{0x322, "u0043AA40", 4},
	{0x323, "u0043AA50", 5},
	{0x324, "u0043AA60", 0},
	{0x325, "u0043AA70", 2},
	{0x326, "u0043AA80", 4},
	{0x327, "u0043AA90", 1},
	{0x328, "u0043AAA0", 3},
	{0x329, "u0043AAB0", 2},
	{0x32A, "op32A", 1},
	{0x32B, "u0043AAD0", 0},
	{0x32C, "u0043AAE0", 6},
	{0x32D, "u0043AAF0", 2},
	{0x32E, "u0043AB10", 11},
	{0x32F, "u0043AB11", 1},
	{0x330, "u0043AB12", 2},
	{0x332, "u0043AB14", 4},
	{0x334, "u0043AB16", 1},
	{0x335, "u0043AB17", 4},
	{0x337, "u0043AB19", 4},
	{0x33B, "u0043AB1D", 4},
	{0x33D, "u0043AB1E", 3},
	{0x33E, "u0043AB1F", 5},
	{0x33F, "u0043AB20", 3},
	{0x340, "op340", 1},
	{0x341, "op341", 2},
	{0x342, "op342", 1},
	{0x344, "op344", 2},
	{0x345, "op345", 3},
	{0x349, "op349", 4},
	{0x34D, "op34D", 6},
	{0x34E, "op34E", 4},
	{0x352, "op352", 3},
	{0x353, "op353", 2},
	{0x354, "op354", 2},
	{0x358, "op358", 5},
	{0x35A, "op35A", 5},
	{0x35B, "op35B", 2},
	{0x35C, "op35C", 2},
	{0x35D, "op35D", 3},
	{0x35F, "op35F", 3},
	{0x360, "op360", 3},
	{0x361, "op361", 2},
	{0x363, "op363", 3},
	{0x364, "op364", 3},
	{0x384, "op384", 3},
	{0x386, "op386", 11},
	{0x387, "op387", 8},
	{0x388, "op388", 3},
	{0x389, "op389", 6},
	{0x38F, "op38F", 6},
	{0x390, "op390", 7},
	{0x391, "op391", 2},
	{0x392, "op392", 1},
	{0x393, "op393", 6},
	{0x396, "op396", 5},
	{0x398, "op398", 3},
	{0x399, "op399", 7},
	{0x39B, "op39B", 5},
}

// labelToOpcode maps label strings to opcodes for assembly
var labelToOpcode map[string]*InstructionDefinition

func init() {
	labelToOpcode = make(map[string]*InstructionDefinition, len(opcodeTable))
	for i := range opcodeTable {
		labelToOpcode[opcodeTable[i].Label] = &opcodeTable[i]
	}
}

// LookupOpcode finds an instruction definition by opcode using binary search
func LookupOpcode(opcode uint32) *InstructionDefinition {
	idx := sort.Search(len(opcodeTable), func(i int) bool {
		return opcodeTable[i].Opcode >= opcode
	})
	if idx < len(opcodeTable) && opcodeTable[idx].Opcode == opcode {
		return &opcodeTable[idx]
	}
	return nil
}

// LookupLabel finds an instruction definition by label
func LookupLabel(label string) *InstructionDefinition {
	return labelToOpcode[label]
}

// Control flow opcodes
var controlFlowOpcodes = map[uint32]bool{
	0x8C: true, // jmp
	0x8F: true, // call
	0xA0: true, // jcc (conditional jump)
	0xCC: true, // mouse_callback
	0xFB: true, // joy_callback
	0xD4: true, // loop function calls
	0x90: true, // unknown loop
	0x7B: true, // unknown control flow
}

// IsControlFlow returns true if the opcode is a control flow instruction
func IsControlFlow(opcode uint32) bool {
	return controlFlowOpcodes[opcode]
}

// IsLabelArgument returns true if the given argument index is a label reference
// for the given instruction
func IsLabelArgument(instr *Instruction, argIdx int) bool {
	if argIdx < 0 || argIdx >= len(instr.Arguments) {
		return false
	}

	// Label arguments have special marker value 0xFFFFFFFF for "no target"
	rawVal := instr.Arguments[argIdx].RawValue
	if rawVal == 0xFFFFFFFF {
		return false
	}

	switch instr.Opcode {
	case 0x8C, 0x8F: // jmp, call - arg 0 is label
		return argIdx == 0
	case 0xA0: // jcc - args 1 and 2 are labels
		return argIdx > 0
	case 0xCC, 0xFB: // mouse_callback, joy_callback - arg 1 is label
		return argIdx == 1
	case 0xD4: // loop - args 2 and 3 are labels
		return argIdx >= 2
	case 0x90: // unknown - args 4, 5, 6 are labels
		return argIdx >= 4
	case 0x7B: // unknown - both args are labels
		return true
	}
	return false
}
